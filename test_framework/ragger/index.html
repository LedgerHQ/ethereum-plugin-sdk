
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Ethereum plugins">
      
      
        <meta name="author" content="fbeutin@ledger.fr">
      
      
        <link rel="canonical" href="https://ethereum-plugin-sdk.ledger.com/test_framework/ragger/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../fuzzing/">
      
      
        
      
      
      <link rel="icon" href="../../img/Ledger-logo-696.webp">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Functional tests - Ethereum plugins documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#functional-tests" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Ethereum plugins documentation" class="md-header__button md-logo" aria-label="Ethereum plugins documentation" data-md-component="logo">
      
  <img src="../../img/Ledger-logo-696.webp" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ethereum plugins documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Functional tests
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Ethereum plugins documentation" class="md-nav__button md-logo" aria-label="Ethereum plugins documentation" data-md-component="logo">
      
  <img src="../../img/Ledger-logo-696.webp" alt="logo">

    </a>
    Ethereum plugins documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../technical_informations/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Technical Informations
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Technical Informations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical_informations/diagram/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sequence diagram
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../technical_informations/handlers/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Handlers
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Handlers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical_informations/handlers/handle_init_contract/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    handle_init_contract()
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical_informations/handlers/handle_provide_parameter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    handle_provide_parameter()
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical_informations/handlers/handle_finalize/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    handle_finalize()
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical_informations/handlers/handle_provide_token/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    handle_provide_token()
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical_informations/handlers/handle_query_contract_id/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    handle_query_contract_id()
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical_informations/handlers/handle_query_contract_ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    handle_query_contract_ui()
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../technical_informations/utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Utility functions
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Utility functions
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical_informations/utils/common_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    common_utils.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical_informations/utils/plugin_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    plugin_utils.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical_informations/tx_content/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Transaction data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical_informations/globals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Global variables and semi-persistent memory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Test Framework
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Test Framework
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Functional tests
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Functional tests
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tools-used" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tools used
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compiling-the-binaries" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compiling the binaries
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Compiling the binaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#plugin-binaries" class="md-nav__link">
    <span class="md-ellipsis">
      
        Plugin binaries
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethereum-binaries" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ethereum binaries
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launching-the-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Launching the tests
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Launching the tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#macos-windows" class="md-nav__link">
    <span class="md-ellipsis">
      
        macOS / Windows
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-ubuntu" class="md-nav__link">
    <span class="md-ellipsis">
      
        Linux (Ubuntu)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#developing-your-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Developing your tests
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-ledger-ethereum-client" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using the Ledger Ethereum client
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the Ledger Ethereum client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cal-signature-mock" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAL signature mock
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abis" class="md-nav__link">
    <span class="md-ellipsis">
      
        ABIs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signature-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Signature verification
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fuzzing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fuzzing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ci/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../walkthrough/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Walkthrough overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tools-used" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tools used
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compiling-the-binaries" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compiling the binaries
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Compiling the binaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#plugin-binaries" class="md-nav__link">
    <span class="md-ellipsis">
      
        Plugin binaries
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethereum-binaries" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ethereum binaries
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launching-the-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Launching the tests
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Launching the tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#macos-windows" class="md-nav__link">
    <span class="md-ellipsis">
      
        macOS / Windows
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-ubuntu" class="md-nav__link">
    <span class="md-ellipsis">
      
        Linux (Ubuntu)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#developing-your-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Developing your tests
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-ledger-ethereum-client" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using the Ledger Ethereum client
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the Ledger Ethereum client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cal-signature-mock" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAL signature mock
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abis" class="md-nav__link">
    <span class="md-ellipsis">
      
        ABIs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signature-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Signature verification
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="functional-tests">Functional tests</h1>
<p>The tests craft APDUs, send them to the application, and assert the RAPDUs results and the screen content.<br/>
You will need to adapt / enrich the test database with tests relevant to your plugin.<br/>
The presence of functional testing of your plugin and an associated CI is mandatory.</p>
<h2 id="tools-used">Tools used</h2>
<ul>
<li>The <a href="https://github.com/LedgerHQ/speculos">Speculos</a> tool is used to emulate the device and its applications.</li>
<li>The <a href="https://github.com/LedgerHQ/ragger">Ragger</a> test framework (pytest based) is used to manage the Speculos instance and provide useful helper functions (APDU exchanges, screen navigation, etc).</li>
<li>The <a href="https://github.com/LedgerHQ/ledger-vscode-extension">Ledger VSCode extension</a> can optionnaly be used to compile the application and run the tests. This documentation will describe using the <code>VSCode extension</code> and <code>bash</code> command lines.</li>
<li>The <a href="https://pypi.org/project/ledger-app-clients.ethereum/">Ledger Ethereum client</a> (<a href="https://pypi.org/project/web3/">Web3</a> based) can be used to craft the smart contract transactions.</li>
</ul>
<p>This frameworks are developed by Ledger, if you have trouble using them, we invite you to get in touch with us on our <a href="https://developers.ledger.com/contact/">Discord</a>.<br/>
The usage of the Ragger framework for your tests is greatly recommended.</p>
<h2 id="compiling-the-binaries">Compiling the binaries</h2>
<p>In order to run the tests you need to provide the binaries for both the plugin and the Ethereum application.</p>
<h3 id="plugin-binaries">Plugin binaries</h3>
<p>Compiling the plugin will produce the binary for the targeted device. They will be used in-place by the test framework.</p>
<h3 id="ethereum-binaries">Ethereum binaries</h3>
<p>The binaries of the Ethereum application must be gathered and placed in the directory <code>tests/.test_dependencies/ethereum/</code> of your plugin.</p>
<p>Example of the correct file tree with Ethereum compiled for all targets:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>$<span class="w"> </span>tree<span class="w"> </span>-a<span class="w"> </span>-L<span class="w"> </span><span class="m">3</span><span class="w"> </span>.test_dependencies/
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>.test_dependencies/
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>└──<span class="w"> </span>ethereum
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span>├──<span class="w"> </span>.ethereum_application_build_goes_there
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span>└──<span class="w"> </span>build
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">        </span>├──<span class="w"> </span>flex
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">        </span>├──<span class="w"> </span>apex_p
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">        </span>├──<span class="w"> </span>nanos
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">        </span>├──<span class="w"> </span>nanos2
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">        </span>├──<span class="w"> </span>nanox
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">        </span>└──<span class="w"> </span>stax
</code></pre></div></p>
<p>Several methods are available:</p>
<ul>
<li>Use the Ledger VSCode extension to automatically manage dependencies.</li>
<li>Clone the <a href="https://github.com/LedgerHQ/app-ethereum">Ethereum application</a> in the <code>.test_dependencies/</code> directory and compile it.<ul>
<li>You will need to set the compilation flags manually to compile for tests.</li>
<li>Open the <a href="https://github.com/LedgerHQ/app-ethereum/blob/develop/ledger_app.toml">Ethereum application manifest</a> and use the flags from <code>use_test_keys</code></li>
</ul>
</li>
<li>Re-use the Ethereum build produced by a test CI, and available as artifact. Example here with the <a href="https://github.com/LedgerHQ/app-plugin-boilerplate/actions/workflows/build_and_functional_tests.yml">plugin-boilerplate CI</a>.</li>
</ul>
<h2 id="launching-the-tests">Launching the tests</h2>
<p>The plugin boilerplate application comes with some template functional tests.</p>
<h3 id="macos-windows">macOS / Windows</h3>
<p>To test your application on macOS or Windows, it is recommended to use <a href="https://github.com/LedgerHQ/ledger-vscode-extension">Ledger VSCode extension</a> to quickly setup a working test environment.</p>
<p>You can use the following task (accessible in the <strong>extension sidebar menu</strong>) :</p>
<ul>
<li>Use <code>Run tests</code>.</li>
</ul>
<h3 id="linux-ubuntu">Linux (Ubuntu)</h3>
<p>On Linux, you can use <a href="https://github.com/LedgerHQ/ledger-vscode-extension">Ledger VSCode extension</a> to run the tests.</p>
<p>Alternatively, you can run the test by command lines in your terminal.</p>
<p>Install the tests requirements (only needed once):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>tests/requirements.txt
</code></pre></div>
<p>Run the tests. For example, run the following command to run all tests on all devices:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>pytest<span class="w"> </span>-v<span class="w"> </span>tests/<span class="w"> </span>--device<span class="w"> </span>all
</code></pre></div>
<p>Please refer to the Ragger repository for a documentation on the many parameters and features offered by the framework.</p>
<h2 id="developing-your-tests">Developing your tests</h2>
<p>The test provided in <code>test_swap.py</code> is a simple test of a successful parsing, display, and signature of smart contract <code>swapExactETHForTokens</code>.</p>
<p>When forking the boilerplate to develop your own plugin, you will need to adapt the tests to use your own smart contract.</p>
<h2 id="using-the-ledger-ethereum-client">Using the <a href="https://pypi.org/project/ledger-app-clients.ethereum/">Ledger Ethereum client</a></h2>
<p>The <a href="https://pypi.org/project/ledger-app-clients.ethereum/">Ledger Ethereum client</a> is a Python module that abstracts the APDU crafting and response parsing. It comes from the Ethereum app itself and is what's used to test it in its CI. Conveniently, it also has everything needed for testing plugins.</p>
<h3 id="cal-signature-mock">CAL signature mock</h3>
<p>This module supports the official Ethereum appplication test signing keys, so that APDUs that are signed by the <a href="https://github.com/LedgerHQ/ledger-live/tree/develop/libs/ledgerjs/packages/cryptoassets">Ledger backend CAL</a> in production can be mocked during the tests.</p>
<p>The Ethereum application must be compiled with the test keys flags. Please refer to the Ethereum application compilation section to know more about this.</p>
<h3 id="abis">ABIs</h3>
<p>The Ethereum Ragger client relies on the <a href="https://pypi.org/project/web3/">Web3</a> python module for transaction crafting and it can leverage a smart contract's ABI (Application Binary Interface) to craft contracts.<br/>
ABIs are obtainable from a website like <a href="https://etherscan.io/">Etherscan</a> for example.</p>
<h3 id="signature-verification">Signature verification</h3>
<p>The Ragger client can also easily verify a transaction's signature by recovering the Ethereum address of the wallet that signed the transaction.<br/>
Testing the UI is crucial but so is testing the signatures we produce.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.indexes", "navigation.expand"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>